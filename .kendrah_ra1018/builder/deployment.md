# Deployment

**Module:** Builder → Deployment
**Primary Language:** Python, Bash, YAML
**Status:** Active

---

## Overview

KENDRAH manages the full deployment lifecycle for any application it builds. From generating Dockerfiles and environment configurations to orchestrating cloud deployments, KENDRAH handles the infrastructure layer so you can focus on the application layer.

---

## Deployment Pipeline

```
Code Complete & Tests Passing
        ↓
Environment Configuration (env vars, secrets)
        ↓
Containerization (Dockerfile + docker-compose)
        ↓
Build & Image Creation
        ↓
Target Platform Selection
        ↓
Deploy & Verify
        ↓
Post-Deploy Health Check
        ↓
Log & Report
```

---

## Environment Management

KENDRAH generates and manages environment configuration files:

### `.env` File Generation
```bash
# Auto-generated by KENDRAH
APP_ENV=production
DATABASE_URL=postgresql://user:password@host:5432/dbname
SECRET_KEY=<generated-secret>
DEBUG=false
PORT=8000
```

### Environment Rules
- Secrets are never hardcoded in source files — always loaded from environment variables.
- KENDRAH generates a `.env.example` (safe, no real values) for version control.
- `.env` files are always added to `.gitignore` automatically.

---

## Docker Support

### Dockerfile Generation (Python/FastAPI example)
```dockerfile
# Auto-generated by KENDRAH
FROM python:3.11-slim

WORKDIR /app

COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

COPY . .

EXPOSE 8000

CMD ["uvicorn", "main:app", "--host", "0.0.0.0", "--port", "8000"]
```

### docker-compose.yml Generation
```yaml
# Auto-generated by KENDRAH
version: "3.9"
services:
  app:
    build: .
    ports:
      - "8000:8000"
    env_file:
      - .env
    depends_on:
      - db
  db:
    image: postgres:15
    environment:
      POSTGRES_USER: user
      POSTGRES_PASSWORD: password
      POSTGRES_DB: appdb
    volumes:
      - postgres_data:/var/lib/postgresql/data

volumes:
  postgres_data:
```

---

## Supported Deployment Targets

| Platform          | Type                | KENDRAH Support                              |
|-------------------|---------------------|----------------------------------------------|
| **Docker**        | Container           | Dockerfile + docker-compose generation       |
| **Vercel**        | Serverless/Frontend | `vercel.json` config, CLI deploy             |
| **Netlify**       | Frontend/Serverless | `netlify.toml`, build settings               |
| **AWS (EC2)**     | VM                  | Setup scripts, Nginx config, systemd service |
| **AWS (Lambda)**  | Serverless          | Lambda handler wrapper, SAM template         |
| **Heroku**        | PaaS                | `Procfile`, `runtime.txt` generation         |
| **DigitalOcean**  | VM/App Platform     | App spec YAML, Droplet setup scripts         |
| **Railway**       | PaaS                | `railway.toml`, environment setup            |
| **Local**         | Development         | `Makefile`, run scripts, dev server config   |

---

## CI/CD Pipeline Generation

KENDRAH generates CI/CD configuration files for automated testing and deployment:

### GitHub Actions (`.github/workflows/deploy.yml`)
```yaml
name: Deploy

on:
  push:
    branches: [main]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.11"
      - name: Install dependencies
        run: pip install -r requirements.txt
      - name: Run tests
        run: pytest --cov=src

  deploy:
    needs: test
    runs-on: ubuntu-latest
    steps:
      - name: Deploy to production
        run: echo "Deploy step here"
```

---

## Post-Deploy Verification

After any deployment, KENDRAH performs:
- HTTP health check on the deployed endpoint (`/health` or `/`)
- Response time measurement
- Confirmation that expected routes return correct status codes
- Alert if any check fails, with rollback recommendation

---

## Deployment Commands

```
/deploy [environment]             — Deploy to a named environment
/docker build                     — Build Docker image
/docker run                       — Run container locally
/docker push [registry]           — Push image to registry
/env setup [platform]             — Generate environment config for platform
/generate dockerfile              — Generate Dockerfile for current project
/generate cicd [platform]         — Generate CI/CD pipeline config
/deploy --health-check            — Run post-deploy verification only
```
